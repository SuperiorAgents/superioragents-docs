"use strict";(self.webpackChunksuperior_agents_docs=self.webpackChunksuperior_agents_docs||[]).push([[7096],{4716:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"use-cases/case-study/agir/retraining-process","title":"The Retraining Process","description":"This kind of system would, in theory, be an ideal candidate for a Group Relative Policy Optimisation fine-tuning approach, as used by Deepseek (Shao et al. 2024), given that the ideal outcome is a large number of competing answers to the same few basic questions. Unfortunately, we have, as yet, been unable to run our system at a scale sufficient to provide the data required for such an approach.","source":"@site/docs/use-cases/case-study/agir/retraining-process.md","sourceDirName":"use-cases/case-study/agir","slug":"/use-cases/case-study/agir/retraining-process","permalink":"/superioragents-docs/docs/use-cases/case-study/agir/retraining-process","draft":false,"unlisted":false,"editUrl":"https://github.com/superioragents/superior-agents/edit/main/docs/use-cases/case-study/agir/retraining-process.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"The Retraining Process"},"sidebar":"tutorialSidebar","previous":{"title":"Learning through Exploration","permalink":"/superioragents-docs/docs/use-cases/case-study/agir/learning-through-expression"},"next":{"title":"Experimental Environment","permalink":"/superioragents-docs/docs/use-cases/case-study/agir/experimental-environment"}}');var i=n(4848),r=n(8453);const a={sidebar_position:3,title:"The Retraining Process"},d=void 0,o={},c=[{value:"DPO Data Composition",id:"dpo-data-composition",level:3},{value:"Pairing &amp; Rejection",id:"pairing--rejection",level:3},{value:"Automated Training Pipeline",id:"automated-training-pipeline",level:2}];function l(e){const s={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.p,{children:"This kind of system would, in theory, be an ideal candidate for a Group Relative Policy Optimisation fine-tuning approach, as used by Deepseek (Shao et al. 2024), given that the ideal outcome is a large number of competing answers to the same few basic questions. Unfortunately, we have, as yet, been unable to run our system at a scale sufficient to provide the data required for such an approach."}),"\n",(0,i.jsx)(s.p,{children:"Failing this, we had recourse to DPO fine-tuning. Under a normal fine-tuning process, we simply input a list of prompts and chosen/rejected responses. The problem in the case of the Generalising Agent is that we have two sets of prompts and responses, with some runs producing chosen but not rejected responses, and others producing rejected but not chosen ones."}),"\n",(0,i.jsx)(s.p,{children:"Thus, for example, if a strategy never succeeds we have a rejected response but no chosen one, while if it succeeds first time we have a chosen response but no rejected one. In the latter case it is possible to generate a high-temperature garbled output to serve as the rejected response; in the former case, unfortunately, the run must be discarded."}),"\n",(0,i.jsx)(s.h3,{id:"dpo-data-composition",children:"DPO Data Composition"}),"\n",(0,i.jsx)(s.p,{children:"The result is a DPO file composed from the following data taken from the chat history of the model interactions:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Process"}),(0,i.jsx)(s.th,{children:"Prompt"}),(0,i.jsx)(s.th,{children:"Response"}),(0,i.jsx)(s.th,{children:"Score"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"If a strategy generates code that compiles and runs but fails to free space"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"get_system_plist + get_basic_env_plist + get_special_egc_req_plist + get_strat_code_req_plist"})}),(0,i.jsx)(s.td,{children:"strat"}),(0,i.jsx)(s.td,{children:"0"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"If a strategy generates code that failed to compile/run"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"new_sp_egc_s"})}),(0,i.jsx)(s.td,{children:"strat"}),(0,i.jsx)(s.td,{children:"0"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"If a strategy generates successful code"}),(0,i.jsx)(s.td,{children:"strat"}),(0,i.jsx)(s.td,{children:"code"}),(0,i.jsx)(s.td,{children:"space_freed"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"If a strategy generates successful code (full-env prompt)"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"get_system_plist + get_basic_env_plist + get_special_egc_req_plist + get_strat_code_req_plist"})}),(0,i.jsx)(s.td,{children:"strat"}),(0,i.jsx)(s.td,{children:"space_freed"})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"pairing--rejection",children:"Pairing & Rejection"}),"\n",(0,i.jsx)(s.p,{children:"This is then sorted/abandoned/paired with deliberately garbled code per the requirements of the training process:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Process"}),(0,i.jsx)(s.th,{children:"Prompt"}),(0,i.jsx)(s.th,{children:"Chosen"}),(0,i.jsx)(s.th,{children:"Rejected"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"If no code capable of running or compiling is produced by the end of a run"}),(0,i.jsx)(s.td,{children:"\u2013"}),(0,i.jsx)(s.td,{children:"\u2013"}),(0,i.jsx)(s.td,{children:"\u2013"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"If some code attempts during the run freed up space and some didn\u2019t"}),(0,i.jsx)(s.td,{children:"strat"}),(0,i.jsx)(s.td,{children:"code (that resulted in a score > 0)"}),(0,i.jsx)(s.td,{children:"code (that resulted in a score = 0)"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"If everything in the run worked first time"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"get_system_plist + get_basic_env_plist + get_special_egc_req_plist + get_strat_code_req_plist"})}),(0,i.jsx)(s.td,{children:"strat (score > 0)"}),(0,i.jsx)(s.td,{children:"deliberately garbled version of strat"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"If everything in the run worked first time (code-level pairing)"}),(0,i.jsx)(s.td,{children:"strat"}),(0,i.jsx)(s.td,{children:"code (score > 0)"}),(0,i.jsx)(s.td,{children:"deliberately garbled version of code"})]})]})]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsx)(s.h2,{id:"automated-training-pipeline",children:"Automated Training Pipeline"}),"\n",(0,i.jsx)(s.p,{children:"A pipeline automates the process of training an AI language model using a Direct Preference Optimization (DPO) JSONL dataset:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Environment Setup"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Creates a ",(0,i.jsx)(s.code,{children:"requirements.txt"})," with necessary ML/AI libraries"]}),"\n",(0,i.jsx)(s.li,{children:"Sets up environment variables for Docker image management"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Training Script Creation"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Generates a Python script implementing DPO training"}),"\n",(0,i.jsx)(s.li,{children:"Uses 4-bit quantization for memory efficiency"}),"\n",(0,i.jsx)(s.li,{children:"Implements Low-Rank Adaptation (LoRA) for efficient fine-tuning"}),"\n",(0,i.jsx)(s.li,{children:"Handles both the main model and a reference model for training"}),"\n",(0,i.jsx)(s.li,{children:"Includes utility functions for parameter management and layer detection"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Docker Configuration"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Creates a ",(0,i.jsx)(s.code,{children:"Dockerfile"})," based on Python 3.10"]}),"\n",(0,i.jsx)(s.li,{children:"Installs required system dependencies and build tools"}),"\n",(0,i.jsx)(s.li,{children:"Configures the training environment for GPU support"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Training Process"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Accepts a JSONL file as training data"}),"\n",(0,i.jsx)(s.li,{children:"Builds and launches a Docker container with GPU support"}),"\n",(0,i.jsx)(s.li,{children:"Executes the training script inside the container"}),"\n",(0,i.jsx)(s.li,{children:"Persists trained model outputs to a specified volume"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Post-Processing"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Cleans up Docker resources (images, containers)"}),"\n",(0,i.jsx)(s.li,{children:"Archives the resulting model artifacts for deployment or further analysis"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>d});var t=n(6540);const i={},r=t.createContext(i);function a(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);